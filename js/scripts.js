var view=function(){"use strict";return{question:document.getElementById("question"),score:document.getElementById("score"),feedback:document.getElementById("feedback"),start:document.getElementById("start"),form:document.getElementById("answer"),timer:document.getElementById("timer"),hiScore:document.getElementById("hiScore"),update:function(e,t,i){var o=e.firstChild||document.createElement("p");o.textContent=t,e.appendChild(o),i&&(o.className=i)},hide:function(e){e.style.display="none"},show:function(e){e.style.display="block"}}}();function getQuiz(){"use strict";var e=new XMLHttpRequest;e.onreadystatechange=function(){4===e.readyState&&200==e.status&&new Game(JSON.parse(e.responseText))},e.open("GET","https://s3.amazonaws.com/sitepoint-book-content/jsninja/quiz.json",!0),e.overrideMimeType("application/json"),e.send(),view.update(view.question,"Waiting for questions...")}function random(e,t,i){"use strict";void 0===t&&(t=e,e=1);var o=Math.floor((t-e+1)*Math.random())+e;return"function"==typeof i&&(o=i(o)),o}function Game(e){"use strict";this.questions=e.questions,this.phrase=e.question,this.score=0,view.update(view.score,this.score),view.update(view.hiScore,this.hiScore()),this.time=20,view.update(view.timer,this.time),this.interval=window.setInterval(this.countDown.bind(this),1e3),view.hide(view.start),view.show(view.form),view.form.addEventListener("click",function(e){e.preventDefault(),this.check(e.target.value)}.bind(this),!1),this.chooseQuestion()}Game.prototype.chooseQuestion=function(){var e=this.questions.filter(function(e){return!1===e.asked});this.question=e[random(e.length)-1],this.ask(this.question)},Game.prototype.ask=function(t){var i=this;t.asked=!0,view.update(view.question,this.phrase+t.question+"?"),view.form.innerHTML="";var o,n=[],e=r();n.push(e.answer);var s=r();function r(){var e=i.questions[random(i.questions.length)-1];return e===t||-1!==n.indexOf(e.answer)?r():e}n.push(s.answer),n.splice(random(0,2),0,this.question.answer),n.forEach(function(e){(o=document.createElement("button")).value=e,o.textContent=e,view.form.appendChild(o)})},Game.prototype.check=function(e){e===this.question.answer?(view.update(view.feedback,"Correct!","correct"),this.score++,view.update(view.score,this.score)):view.update(view.feedback,"Wrong!","wrong"),this.chooseQuestion()},Game.prototype.countDown=function(){this.time--,view.update(view.timer,this.time),this.time<=0&&this.gameOver()},Game.prototype.gameOver=function(){view.update(view.question,"Game Over, you scored "+this.score+" points"),window.clearInterval(this.interval),view.hide(view.form),view.show(view.start)},Game.prototype.hiScore=function(){if(window.localStorage){var e=localStorage.getItem("hiScore")||0;return(this.score>e||0===e)&&localStorage.setItem("hiScore",this.score),localStorage.getItem("hiScore")}},view.start.addEventListener("click",getQuiz,!1),view.hide(view.form);